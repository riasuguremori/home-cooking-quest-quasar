import{Q as _}from"./QToolbarTitle-uhcdwykv.js";import{Q as C}from"./QMenu-DHbgiscJ.js";import{z as u,h as D,o as U,j as o,U as p,b as d,e as l,Q as c,M as A,S as n,L,af as k,a0 as E,ad as T,$ as y,t as x,ae as N}from"./index-CCltDTcc.js";import{Q as P}from"./QToolbar-DVqQvwW-.js";import{a as h,Q as q}from"./QTable-D19l5PzE.js";import{Q as B}from"./QForm-CoHpBmVC.js";import{Q as F}from"./QPage-DfUJbLHa.js";import{u as O}from"./use-quasar-CUmE3VzD.js";import"./position-engine-DhZ2HoGy.js";import"./selection-CUV_63Hm.js";import"./QVirtualScroll-CF7Nsi2E.js";import"./QChip-X1ikjzpS.js";import"./QList-D8PYKg1x.js";import"./QItemLabel-7_chNhSH.js";import"./format-hlGAdIUH.js";import"./use-fullscreen-CrZqwLof.js";const R={class:"q-pa-md"},$={class:"row"},I={class:"col-12"},J={class:"text-h6"},ie={__name:"accountsPage",setup(M){const i=O(),f=u([]),m=u(""),r=u({open:!1,id:""}),g=()=>({account:0,points:{current:0,totalEarned:0},role:"",missionStatus:{lastLoginDate:"",dailyPostCount:0,dailyRecipeCount:0}}),s=u(g()),Q=["admin","user"],V=[{name:"account",label:"使用者帳號",field:"account",align:"left",sortable:!0},{name:"current",label:"餘額",field:e=>e.points.current,align:"right",sortable:!0},{name:"totalEarned",label:"總積分",field:e=>e.points.totalEarned,align:"right",sortable:!0},{name:"role",label:"身份",field:"role",format:e=>e||"未知",align:"left",sortable:!0},{name:"dailyPostCount",label:"發文數",field:e=>e.missionStatus.dailyPostCount,align:"left",sortable:!0},{name:"dailyRecipeCount",label:"新增食譜數",field:e=>e.missionStatus.dailyRecipeCount,align:"left",sortable:!0},{name:"lastLoginDate",label:"最後登入時間",field:e=>new Date(e.missionStatus.lastLoginDate).toLocaleString(),align:"left",sortable:!0},{name:"createdAt",label:"創建日期",field:"createdAt",format:e=>new Date(e).toLocaleString(),align:"left",sortable:!0},{name:"updatedAt",label:"更新日期",field:"updatedAt",format:e=>new Date(e).toLocaleString(),align:"left",sortable:!0},{name:"actions",label:"操作",align:"center"}],v=async()=>{try{const{data:e}=await p.getAllAccount();f.value=e.result}catch(e){console.log(e),i.notify({message:"取得使用者失敗",color:"negative"})}},w=e=>{if(r.value.open=!0,e){r.value.id=e._id;const t=JSON.parse(JSON.stringify(e));s.value={...t}}else r.value.id="",s.value=g()},b=()=>{r.value.open=!1},S=async()=>{try{r.value.id?(await p.updateUser(r.value.id,s.value),i.notify({message:"更新成功",color:"positive"})):(await p.create(s.value),i.notify({message:"新增成功",color:"positive"})),b(),v()}catch(e){console.log(e);const t=e?.response?.data?.message||"發生錯誤";i.notify({message:t,color:"negative"})}};return v(),(e,t)=>(U(),D(F,{padding:""},{default:o(()=>[d("div",R,[d("div",$,[d("div",I,[l(h,{rows:f.value,columns:V,"row-key":"_id",flat:"",bordered:"",filter:m.value},{top:o(()=>[l(P,null,{default:o(()=>[l(_,null,{default:o(()=>[...t[6]||(t[6]=[A("使用者管理",-1)])]),_:1}),l(C),l(n,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=a=>m.value=a),dense:"",debounce:"500",placeholder:"搜尋",color:"primary"},{append:o(()=>[l(L,{name:"search"})]),_:1},8,["modelValue"])]),_:1})]),"body-cell-actions":o(a=>[l(q,{props:a},{default:o(()=>[l(c,{icon:"edit",flat:"",round:"",onClick:j=>w(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])])])]),l(k,{modelValue:r.value.open,"onUpdate:modelValue":t[5]||(t[5]=a=>r.value.open=a),persistent:""},{default:o(()=>[l(E,{style:{"min-width":"80vw","max-width":"80vw"}},{default:o(()=>[l(B,{onSubmit:T(S,["prevent"])},{default:o(()=>[l(y,null,{default:o(()=>[d("div",J,x(e.編輯使用者),1)]),_:1}),l(y,{class:"q-gutter-md"},{default:o(()=>[l(n,{modelValue:s.value.account,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.account=a),label:"使用者帳號",rules:[a=>!!a||"更新使用者帳號"]},null,8,["modelValue","rules"]),l(n,{modelValue:s.value.points.current,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.points.current=a),label:"使用者餘額",rules:[a=>!!a||"更新使用者餘額"]},null,8,["modelValue","rules"]),l(n,{modelValue:s.value.points.totalEarned,"onUpdate:modelValue":t[3]||(t[3]=a=>s.value.points.totalEarned=a),label:"使用者總積分",rules:[a=>!!a||"更新使用者總積分"]},null,8,["modelValue","rules"]),l(n,{modelValue:s.value.role,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.role=a),options:Q,label:"身份",rules:[a=>!!a||"更新身份"]},null,8,["modelValue","rules"])]),_:1}),l(N,{align:"right",class:"q-pa-md"},{default:o(()=>[l(c,{flat:"",label:"取消",color:"negative",onClick:b}),l(c,{type:"submit",label:"儲存",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{ie as default};
