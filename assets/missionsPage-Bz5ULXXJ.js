import{Q as _}from"./QToolbarTitle-uhcdwykv.js";import{Q as k}from"./QMenu-DHbgiscJ.js";import{z as r,h as M,o as x,j as i,b as d,e as a,Q as u,M as D,S as m,L as T,af as q,a0 as N,ad as O,$ as w,t as R,ae as B}from"./index-CCltDTcc.js";import{Q as $}from"./QToolbar-DVqQvwW-.js";import{a as F,Q as E}from"./QTable-D19l5PzE.js";import{Q as f}from"./QVirtualScroll-CF7Nsi2E.js";import{Q as I}from"./QEditor-CAwAF0_9.js";import{Q as J}from"./QForm-CoHpBmVC.js";import{Q as P}from"./QPage-DfUJbLHa.js";import{u as j}from"./use-quasar-CUmE3VzD.js";import{m as v}from"./mission-DCnqKz_c.js";import"./position-engine-DhZ2HoGy.js";import"./selection-CUV_63Hm.js";import"./use-fullscreen-CrZqwLof.js";import"./QChip-X1ikjzpS.js";import"./QList-D8PYKg1x.js";import"./QItemLabel-7_chNhSH.js";import"./format-hlGAdIUH.js";import"./QTooltip-BAXmC6CC.js";const z={class:"q-pa-md"},h={class:"row"},G={class:"col-12"},H={class:"text-h6"},ge={__name:"missionsPage",setup(K){const n=j(),c=r([]),p=r(""),g=r(!1),s=r({open:!1,id:""}),b=()=>({code:"",name:"",description:"",pointsReward:0,limit:"每日",dailyLimit:0,isActive:"true"}),o=r(b()),S=["每日簽到","發文","解鎖食譜","官方發放","新增食譜"],A=["唯一","每日","無限制"],U=["true","false"],C=[{name:"code",label:"任務代碼",field:"code",align:"left",sortable:!0},{name:"name",label:"任務名字",field:"name",align:"left",sortable:!0},{name:"pointsReward",label:"任務積分",field:"pointsReward",align:"right",sortable:!0},{name:"limit",label:"限制",field:"limit",format:t=>t||"未知",align:"right",sortable:!0},{name:"dailyLimit",label:"每日上限",field:"dailyLimit",align:"right",sortable:!0},{name:"createdAt",label:"創建日期",field:"createdAt",format:t=>new Date(t).toLocaleString(),align:"left",sortable:!0},{name:"updatedAt",label:"更新日期",field:"updatedAt",format:t=>new Date(t).toLocaleString(),align:"left",sortable:!0},{name:"actions",label:"操作",align:"center"}],V=async()=>{try{const{data:t}=await v.getAllMission();c.value=t.result}catch{n.notify({message:"取得任務失敗",color:"negative"})}},Q=t=>{if(s.value.open=!0,t){s.value.id=t._id;const l=JSON.parse(JSON.stringify(t));o.value={...l}}else s.value.id="",o.value=b()},y=()=>{s.value.open=!1},L=async()=>{try{g.value=!0,s.value.id?(await v.updateMission(s.value.id,o.value),n.notify({message:"更新成功",color:"positive"})):(await v.createMission(o.value),n.notify({message:"新增成功",color:"positive"})),y(),V()}catch(t){console.log(t);const l=t?.response?.data?.message||"發生錯誤";n.notify({message:l,color:"negative"})}};return V(),(t,l)=>(x(),M(P,{padding:""},{default:i(()=>[d("div",z,[d("div",h,[d("div",G,[a(F,{rows:c.value,columns:C,"row-key":"_id",flat:"",bordered:"",filter:p.value},{top:i(()=>[a($,null,{default:i(()=>[a(_,null,{default:i(()=>[...l[10]||(l[10]=[D("任務管理",-1)])]),_:1}),a(k),a(m,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=e=>p.value=e),dense:"",debounce:"500",placeholder:"搜尋",color:"primary"},{append:i(()=>[a(T,{name:"search"})]),_:1},8,["modelValue"]),a(u,{color:"primary",icon:"add",label:"新增任務",onClick:l[1]||(l[1]=e=>Q(null)),class:"q-ml-md"})]),_:1})]),"body-cell-actions":i(e=>[a(E,{props:e},{default:i(()=>[a(u,{icon:"edit",flat:"",round:"",onClick:W=>Q(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])])])]),a(q,{modelValue:s.value.open,"onUpdate:modelValue":l[9]||(l[9]=e=>s.value.open=e),persistent:""},{default:i(()=>[a(N,{style:{"min-width":"80vw","max-width":"80vw"}},{default:i(()=>[a(J,{onSubmit:O(L,["prevent"])},{default:i(()=>[a(w,null,{default:i(()=>[d("div",H,R(s.value.id?"編輯任務":"新增任務"),1)]),_:1}),a(w,{class:"q-gutter-md"},{default:i(()=>[a(f,{modelValue:o.value.code,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.code=e),options:S,label:"任務代碼",rules:[e=>!!e||"請輸入任務代碼"]},null,8,["modelValue","rules"]),a(m,{modelValue:o.value.name,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.name=e),label:"任務名稱",rules:[e=>!!e||"請輸入任務名稱"]},null,8,["modelValue","rules"]),a(I,{modelValue:o.value.description,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.description=e),"min-height":"10rem",placeholder:"任務說明"},null,8,["modelValue"]),a(m,{modelValue:o.value.pointsReward,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.pointsReward=e),label:"任務積分",rules:[e=>!!e||"請輸入任務積分"]},null,8,["modelValue","rules"]),a(f,{modelValue:o.value.limit,"onUpdate:modelValue":l[6]||(l[6]=e=>o.value.limit=e),options:A,label:"限制",rules:[e=>!!e||"請選擇限制"]},null,8,["modelValue","rules"]),a(m,{modelValue:o.value.dailyLimit,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.dailyLimit=e),modelModifiers:{number:!0},type:"number",label:"每日上限",rules:[e=>e>=0||"上限不能小於 0"]},null,8,["modelValue","rules"]),a(f,{modelValue:o.value.isActive,"onUpdate:modelValue":l[8]||(l[8]=e=>o.value.isActive=e),options:U,label:"狀態","emit-value":"","map-options":"",rules:[e=>e!==null||"請選擇狀態"]},null,8,["modelValue","rules"])]),_:1}),a(B,{align:"right",class:"q-pa-md"},{default:i(()=>[a(u,{flat:"",label:"取消",color:"negative",onClick:y,disable:g.value},null,8,["disable"]),a(u,{type:"submit",label:"儲存",color:"primary"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{ge as default};
