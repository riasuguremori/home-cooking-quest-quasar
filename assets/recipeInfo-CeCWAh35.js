import{Q as D}from"./QImg-48OQTr1V.js";import{c as v,o as n,b as t,e,h as _,a as b,L as x,t as d,j as s,M as g,Q as q,n as O,F as z,i as S,a0 as k,$ as F,g as H,I as T,z as w,B as E,p as j,K as U,N,S as K,az as G,U as P,O as J}from"./index-CCltDTcc.js";import{Q as W,a as y,b as f}from"./QList-D8PYKg1x.js";import{Q as X}from"./QPage-DfUJbLHa.js";import{Q as Y}from"./QPageContainer-CLUIcwg7.js";import{r as I}from"./recipe-CWeHbSy1.js";import{u as A}from"./use-quasar-CUmE3VzD.js";import{Q as R}from"./QRating-Bnr8WG8o.js";import{Q as Z}from"./QTooltip-BAXmC6CC.js";import{Q as M}from"./QChip-X1ikjzpS.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as ee}from"./QScrollArea-CmzUWhe-.js";import{c as L}from"./comment-D-Ok87oV.js";import"./format-hlGAdIUH.js";import"./position-engine-DhZ2HoGy.js";import"./selection-CUV_63Hm.js";import"./QResizeObserver-B-ajq8rO.js";import"./TouchPan-Bw1igJGw.js";import"./touch-BjYP5sR0.js";const te={class:"col-12 col-md-8"},oe={class:"q-mb-xl"},se={class:"row items-center q-mb-md"},le={class:"text-h5 text-weight-bold"},ae=["innerHTML"],ie={class:"row q-col-gutter-md"},ne={class:"col-12 col-md-8"},re={class:"row justify-between",style:{"max-width":"400px","border-bottom":"1px dashed #eee"}},ce={class:"text-weight-bold"},de={class:"col-12 col-md-4"},ue={class:"text-subtitle1 text-weight-bold q-mb-sm text-primary"},me=["src"],ge={key:0,class:"absolute-full flex flex-center glass-overlay"},pe={key:0,class:"row items-center"},fe={__name:"RecipeContent",props:{recipe:{type:Object,required:!0},unlocked:{type:Boolean,default:!1},isCollected:{type:Boolean,default:!1},isLocked:{type:Boolean,default:!1}},emits:["collect","unlock"],setup(l){return(p,o)=>(n(),v("div",te,[t("div",oe,[t("div",se,[e(x,{name:"restaurant",color:"deep-orange",size:"24px",class:"q-mr-sm"}),t("div",le,d(l.recipe.name),1),e(R,{"model-value":l.recipe.rating,size:"1.2em",color:"orange",readonly:"",icon:"star"},null,8,["model-value"]),l.unlocked?b("",!0):(n(),_(q,{key:0,flat:"",round:"",dense:"",icon:l.isCollected?"favorite":"favorite_border",color:l.isCollected?"pink":"grey-5",onClick:o[0]||(o[0]=i=>p.$emit("collect"))},{default:s(()=>[e(Z,null,{default:s(()=>[g(d(l.isCollected?"取消收藏":"加入收藏"),1)]),_:1})]),_:1},8,["icon","color"])),l.unlocked?(n(),_(M,{key:1,color:"green-1","text-color":"green",icon:"lock_open",label:"已解鎖",size:"sm",class:"q-ml-sm"})):b("",!0)]),t("p",{class:"text-body1 text-grey-9",style:{"line-height":"1.6"},innerHTML:l.recipe.description},null,8,ae)]),e(k,{class:"my-card relative-position overflow-hidden",flat:"",bordered:"",style:H(l.isLocked?"height: 400px":"min-height: 400px")},{default:s(()=>[t("div",{class:O(["q-pa-lg",{"blurred-content":l.isLocked}])},[t("div",ie,[t("div",ne,[o[2]||(o[2]=t("div",{class:"text-h6 q-mb-md"},"準備食材",-1)),(n(!0),v(z,null,S(l.recipe.ingredients,i=>(n(),v("div",{class:"text-body2 text-grey-8 q-mb-xs",key:i._id},[t("div",re,[t("span",null,d(i.name),1),t("span",ce,d(i.quantity),1)])]))),128))]),t("div",de,[l.recipe.nutrition&&l.recipe.nutrition.length>0?(n(),_(k,{key:0,flat:"",bordered:"",class:"bg-grey-1"},{default:s(()=>[e(F,null,{default:s(()=>[t("div",ue,[e(x,{name:"analytics",class:"q-mr-xs"}),o[3]||(o[3]=g(" 營養標示 (每份) ",-1))]),e(W,{dense:"",separator:"",class:"text-grey-9"},{default:s(()=>[e(y,null,{default:s(()=>[e(f,null,{default:s(()=>[...o[4]||(o[4]=[g("熱量",-1)])]),_:1}),e(f,{side:"",class:"text-black text-weight-bolder"},{default:s(()=>[g(d(l.recipe.nutrition[0].calories)+" kcal ",1)]),_:1})]),_:1}),e(y,null,{default:s(()=>[e(f,null,{default:s(()=>[...o[5]||(o[5]=[g("蛋白質",-1)])]),_:1}),e(f,{side:""},{default:s(()=>[g(d(l.recipe.nutrition[0].protein)+" g ",1)]),_:1})]),_:1}),e(y,null,{default:s(()=>[e(f,null,{default:s(()=>[...o[6]||(o[6]=[g("脂肪",-1)])]),_:1}),e(f,{side:""},{default:s(()=>[g(d(l.recipe.nutrition[0].fat)+" g ",1)]),_:1})]),_:1}),e(y,null,{default:s(()=>[e(f,null,{default:s(()=>[...o[7]||(o[7]=[g("總碳水化合物",-1)])]),_:1}),e(f,{side:""},{default:s(()=>[g(d(l.recipe.nutrition[0].carbs)+" g ",1)]),_:1})]),_:1}),e(y,{class:"bg-green-1"},{default:s(()=>[e(f,{class:"text-green-9 text-weight-bold"},{default:s(()=>[...o[8]||(o[8]=[g("淨碳水",-1)])]),_:1}),e(f,{side:"",class:"text-green-9 text-weight-bold"},{default:s(()=>[g(d(l.recipe.nutrition[0].netCarbs)+" g ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):b("",!0)])]),(n(!0),v(z,null,S(l.recipe.steps,(i,u)=>(n(),v("div",{class:"text-h6 q-mt-lg q-mb-md",key:i._id},[g(d(`步驟 ${u+1}`)+" ",1),t("p",null,d(i.description),1),t("img",{src:i.imageUrl,style:{"max-width":"100%",height:"auto"}},null,8,me)]))),128))],2),l.isLocked?(n(),v("div",ge,[e(k,{class:"text-center shadow-10 q-pa-lg",style:{"max-width":"350px","border-radius":"16px"}},{default:s(()=>[e(x,{name:"lock",color:"deep-orange",size:"40px",class:"bg-orange-1 q-pa-md rounded-borders q-mb-md"}),e(q,{unelevated:"",rounded:"",color:"deep-orange",size:"lg",class:"full-width text-weight-bold","no-caps":"",onClick:o[1]||(o[1]=i=>p.$emit("unlock"))},{default:s(()=>[l.recipe?(n(),v("div",pe,[t("span",null,"Unlock for "+d(l.recipe.unlockPrice)+" Points",1),e(x,{name:"monetization_on",class:"q-ml-sm"})])):b("",!0)]),_:1})]),_:1})])):b("",!0)]),_:1},8,["style"])]))}},ve=V(fe,[["__scopeId","data-v-cc0e4ce8"]]),be={class:"row items-center q-mb-md"},he={key:0,class:"text-center text-grey-7 q-pa-md"},ye={class:"row items-center q-gutter-xs"},_e={class:"text-body2 q-mt-xs text-grey-9"},xe={class:"row items-center justify-between q-mt-xs"},ke={class:"text-caption text-weight-bold text-deep-orange-8"},we={class:"text-grey-6 text-weight-regular"},qe={class:"row items-center"},$e={class:"text-grey-6 text-caption q-ml-xs"},Ce={class:"bg-white q-pa-sm rounded-borders shadow-1"},Qe={class:"q-mb-sm"},Ie={class:"row q-col-gutter-sm"},Le={class:"col-12 col-sm-12"},ze={__name:"CommentSection",props:{recipeId:{type:String,required:!0}},setup(l){const p=l,o=A(),i=T(),u=w([]),r=w({content:"",rating:0}),h=async()=>{if(p.recipeId)try{const{data:m}=await L.getRecipeComment(p.recipeId);u.value=m.result}catch(m){console.log(m),o.notify({color:"negative",message:"無法取得食譜留言資訊",icon:"report_problem",position:"bottom"})}};E(()=>p.recipeId,()=>{h()},{immediate:!0});const B=async m=>{if(!i.isLoggedIn){o.notify({color:"warning",message:"請先登入",icon:"warning",position:"bottom"});return}try{const{data:a}=await L.toggleLike(m._id);if(a.isLiked)m.likes.push(i._id);else{const c=m.likes.indexOf(i._id);c>-1&&m.likes.splice(c,1)}}catch(a){console.log(a),o.notify({color:"negative",message:"操作失敗",icon:"report_problem",position:"bottom"})}},$=j(()=>r.value.content.trim().length>0&&r.value.rating>0),Q=async()=>{if($.value)try{const m={content:r.value.content,rating:r.value.rating,recipe:p.recipeId},{data:a}=await L.createComment(m);u.value.unshift(a.result),r.value.content="",r.value.rating=0,o.notify({color:"positive",message:"留言成功",icon:"check_circle",position:"bottom"})}catch(m){console.log(m),o.notify({color:"negative",message:"留言失敗，請稍後再試",icon:"report_problem",position:"bottom"})}};return(m,a)=>(n(),_(k,{flat:"",bordered:"",class:"q-pa-md radius-12 bg-orange-1",style:{"border-color":"transparent"}},{default:s(()=>[t("div",be,[e(x,{name:"forum",color:"deep-orange",size:"sm",class:"q-mr-sm"}),a[2]||(a[2]=t("div",{class:"text-h6 text-deep-orange-9"},"食譜留言板",-1)),e(M,{size:"sm",color:"deep-orange-2","text-color":"deep-orange-9",class:"q-ml-sm"},{default:s(()=>[g(d(u.value.length)+" 則評論 ",1)]),_:1})]),e(ee,{style:{height:"250px","max-height":"50vh"},class:"q-mb-md q-pr-sm"},{default:s(()=>[u.value.length===0?(n(),v("div",he," 目前還沒有留言，成為第一個評論的人吧！ ")):b("",!0),(n(!0),v(z,null,S(u.value,(c,C)=>(n(),v("div",{key:C,class:"q-mb-md"},[t("div",ye,[e(R,{"model-value":c.rating,size:"1.2em",color:"orange",readonly:"",icon:"star"},null,8,["model-value"])]),t("div",_e,'"'+d(c.content)+'"',1),t("div",xe,[t("div",ke,[t("span",we,d(new Date(c.createdAt).toLocaleDateString()),1)]),t("div",qe,[e(q,{flat:"",round:"",dense:"",icon:c.likes.includes(U(i)._id)?"favorite":"favorite_border",color:c.likes.includes(U(i)._id)?"red":"grey-5",size:"sm",onClick:je=>B(c)},null,8,["icon","color","onClick"]),t("span",$e,d(c.likes.length),1)])]),C<u.value.length-1?(n(),_(N,{key:0,class:"q-my-sm bg-orange-2"})):b("",!0)]))),128))]),_:1}),e(N,{class:"q-mb-md bg-deep-orange-3"}),t("div",Ce,[t("div",Qe,[a[3]||(a[3]=t("span",{class:"text-caption text-grey"},"您的評分：",-1)),e(R,{modelValue:r.value.rating,"onUpdate:modelValue":a[0]||(a[0]=c=>r.value.rating=c),size:"sm",color:"orange",icon:"star","icon-selected":"star"},null,8,["modelValue"])]),t("div",Ie,[t("div",Le,[e(K,{modelValue:r.value.content,"onUpdate:modelValue":a[1]||(a[1]=c=>r.value.content=c),dense:"",outlined:"",color:"deep-orange",label:"分享您的心得...",type:"textarea",rows:"1",autogrow:"","bg-color":"orange-1"},null,8,["modelValue"])])]),e(q,{unelevated:"",color:"deep-orange",label:"發佈留言",icon:"send",class:"full-width q-mt-sm",disable:!$.value,onClick:Q},null,8,["disable"])])]),_:1}))}},Se=V(ze,[["__scopeId","data-v-e3e47783"]]),Ue={key:0,class:"hero-section relative-position"},Re={key:1,class:"container q-pa-md q-mx-auto",style:{"max-width":"1200px"}},Ve={class:"row q-col-gutter-lg"},Be={class:"col-12 col-md-4 q-gutter-y-lg"},Ne=["src"],Pe={class:"text-h6"},Te={__name:"recipeInfo",setup(l){const p=T(),o=w({name:"",author:{account:""},imageUrl:"",ingredient:[],steps:[],description:"",rating:0,isUnlocked:!0,unlockPrice:0}),i=w(!1),u=A(),r=G(),h=w(!1);(async()=>{try{const{data:a}=await I.getRecipeInfo(r.params.id);if(o.value=a.result,p.isLoggedIn){const{data:c}=await P.unlockedRecipes();i.value=c.result.includes(r.params.id);const{data:C}=await P.getUser();h.value=C.result.savedRecipes.includes(r.params.id)}}catch(a){console.log(a),u.notify({color:"negative",message:"無法取得食譜資訊",icon:"report_problem",position:"bottom"})}})();const $=async()=>{try{await I.unlockRecipe(r.params.id),i.value=!0,u.notify({message:"解鎖成功",color:"positive",icon:"check_circle"})}catch(a){console.log(a),u.notify({color:"negative",message:"解鎖失敗",icon:"report_problem",position:"bottom"})}},Q=async()=>{if(!p.isLoggedIn){u.notify({color:"warning",message:"請先登入才能收藏",icon:"warning",position:"bottom"});return}try{await I.bookMark(r.params.id),h.value=!h.value,u.notify({color:"positive",message:h.value?"已加入收藏":"已取消收藏",icon:"favorite",position:"bottom"})}catch(a){console.log(a),u.notify({color:"negative",message:"操作失敗",icon:"report_problem",position:"bottom"})}},m=j(()=>!p.isLoggedIn||!o.value.isUnlocked&&!p.isAdmin&&!i.value);return(a,c)=>(n(),_(Y,null,{default:s(()=>[e(X,null,{default:s(()=>[o.value?(n(),v("div",Ue,[e(D,{src:o.value.imageUrl,style:{height:"400px"},class:"hero-img"},null,8,["src"])])):b("",!0),o.value?(n(),v("div",Re,[t("div",Ve,[e(ve,{recipe:o.value,unlocked:i.value,"is-collected":h.value,"is-locked":m.value,onCollect:Q,onUnlock:$},null,8,["recipe","unlocked","is-collected","is-locked"]),t("div",Be,[e(k,{flat:"",bordered:"",class:"q-pa-md radius-12 bg-orange-3"},{default:s(()=>[e(y,{class:"q-px-none"},{default:s(()=>[e(f,{avatar:""},{default:s(()=>[e(J,{size:"60px"},{default:s(()=>[t("img",{src:`https://api.dicebear.com/9.x/thumbs/svg?seed=${o.value.author.account}`},null,8,Ne)]),_:1})]),_:1}),e(f,null,{default:s(()=>[t("div",Pe,d(o.value.author.account),1)]),_:1})]),_:1}),e(q,{outline:"",rounded:"",color:"dark",label:"追蹤",class:"full-width","no-caps":""})]),_:1}),e(Se,{"recipe-id":U(r).params.id},null,8,["recipe-id"])])])])):b("",!0)]),_:1})]),_:1}))}},at=V(Te,[["__scopeId","data-v-9e7e369e"]]);export{at as default};
