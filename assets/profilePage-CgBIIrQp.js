import{a1 as rt,a2 as ye,a3 as ze,v as Ve,z as q,p as V,X as Fe,W as ut,P as Ne,R as ct,l as Q,L as F,H as dt,a4 as mt,a5 as vt,a6 as ft,q as fe,a7 as we,a8 as Qe,B as de,a9 as gt,aa as pt,E as je,ab as bt,u as ht,x as yt,Y as wt,I as xt,ac as _t,f as Ct,h as Y,o as C,j as f,e as l,a0 as J,ad as Ee,$ as H,b as s,t as I,a as se,S as B,c as P,F as te,i as le,Q as z,ae as qt,af as Oe,n as _e,M as Ce,O as ne,r as Me,U as kt,J as Vt,N as Tt}from"./index-CCltDTcc.js";import{Q as $t}from"./QResizeObserver-B-ajq8rO.js";import{r as St,Q as Ae}from"./QVirtualScroll-CF7Nsi2E.js";import{u as Pt,a as Rt,b as It,c as Lt}from"./use-panel-D0om12FI.js";import{Q as Ut}from"./QPage-DfUJbLHa.js";import{Q as Dt}from"./QPageContainer-CLUIcwg7.js";import{u as Ke}from"./use-quasar-CUmE3VzD.js";import{d as ee}from"./date-BdkF2Xzz.js";import{r as qe}from"./recipe-CWeHbSy1.js";import{m as Qt}from"./mission-DCnqKz_c.js";import{Q as Mt}from"./QRating-Bnr8WG8o.js";import{Q as Be}from"./QImg-48OQTr1V.js";import{Q as At}from"./QEditor-CAwAF0_9.js";import{Q as ke}from"./QMenu-DHbgiscJ.js";import{Q as Bt}from"./QForm-CoHpBmVC.js";import{Q as me,a as zt}from"./QTable-D19l5PzE.js";import{R as Ft}from"./RecipeCard-DPjAmFN0.js";import{Q as Nt}from"./QTooltip-BAXmC6CC.js";import{C as jt}from"./ClosePopup-DfjdXHmb.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-X1ikjzpS.js";import"./QList-D8PYKg1x.js";import"./QItemLabel-7_chNhSH.js";import"./format-hlGAdIUH.js";import"./touch-BjYP5sR0.js";import"./selection-CUV_63Hm.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-fullscreen-CrZqwLof.js";import"./position-engine-DhZ2HoGy.js";let Et=0;const Ot=["click","keydown"],Kt={icon:String,label:[Number,String],alert:[Boolean,String],alertIcon:String,name:{type:[Number,String],default:()=>`t_${Et++}`},noCaps:Boolean,tabindex:[String,Number],disable:Boolean,contentClass:String,ripple:{type:[Boolean,Object],default:!0}};function Wt(e,w,k,n){const i=rt(ze,ye);if(i===ye)return console.error("QTab/QRouteTab component needs to be child of QTabs"),ye;const{proxy:S}=Ve(),_=q(null),h=q(null),p=q(null),A=V(()=>e.disable===!0||e.ripple===!1?!1:Object.assign({keyCodes:[13,32],early:!0},e.ripple===!0?{}:e.ripple)),u=V(()=>i.currentModel.value===e.name),X=V(()=>"q-tab relative-position self-stretch flex flex-center text-center"+(u.value===!0?" q-tab--active"+(i.tabProps.value.activeClass?" "+i.tabProps.value.activeClass:"")+(i.tabProps.value.activeColor?` text-${i.tabProps.value.activeColor}`:"")+(i.tabProps.value.activeBgColor?` bg-${i.tabProps.value.activeBgColor}`:""):" q-tab--inactive")+(e.icon&&e.label&&i.tabProps.value.inlineLabel===!1?" q-tab--full":"")+(e.noCaps===!0||i.tabProps.value.noCaps===!0?" q-tab--no-caps":"")+(e.disable===!0?" disabled":" q-focusable q-hoverable cursor-pointer")),L=V(()=>"q-tab__content self-stretch flex-center relative-position q-anchor--skip non-selectable "+(i.tabProps.value.inlineLabel===!0?"row no-wrap q-tab__content--inline":"column")+(e.contentClass!==void 0?` ${e.contentClass}`:"")),R=V(()=>e.disable===!0||i.hasFocus.value===!0||u.value===!1&&i.hasActiveTab.value===!0?-1:e.tabindex||0);function D(b,v){if(v!==!0&&b?.qAvoidFocus!==!0&&_.value?.focus(),e.disable!==!0){i.updateModel({name:e.name}),k("click",b);return}}function M(b){mt(b,[13,32])?D(b,!0):vt(b)!==!0&&b.keyCode>=35&&b.keyCode<=40&&b.altKey!==!0&&b.metaKey!==!0&&i.onKbdNavigate(b.keyCode,S.$el)===!0&&ft(b),k("keydown",b)}function E(){const b=i.tabProps.value.narrowIndicator,v=[],o=Q("div",{ref:p,class:["q-tab__indicator",i.tabProps.value.indicatorClass]});e.icon!==void 0&&v.push(Q(F,{class:"q-tab__icon",name:e.icon})),e.label!==void 0&&v.push(Q("div",{class:"q-tab__label"},e.label)),e.alert!==!1&&v.push(e.alertIcon!==void 0?Q(F,{class:"q-tab__alert-icon",color:e.alert!==!0?e.alert:void 0,name:e.alertIcon}):Q("div",{class:"q-tab__alert"+(e.alert!==!0?` text-${e.alert}`:"")})),b===!0&&v.push(o);const d=[Q("div",{class:"q-focus-helper",tabindex:-1,ref:_}),Q("div",{class:L.value},dt(w.default,v))];return b===!1&&d.push(o),d}const N={name:V(()=>e.name),rootRef:h,tabIndicatorRef:p,routeData:n};Fe(()=>{i.unregisterTab(N)}),ut(()=>{i.registerTab(N)});function j(b,v){const o={ref:h,class:X.value,tabindex:R.value,role:"tab","aria-selected":u.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:D,onKeydown:M,...v};return Ne(Q(b,o,E()),[[ct,A.value]])}return{renderTab:j,$tabs:i}}const Ht=fe({name:"QTab",props:Kt,emits:Ot,setup(e,{slots:w,emit:k}){const{renderTab:n}=Wt(e,w,k);return()=>n("div")}});function Yt(e,w,k){const n=k===!0?["left","right"]:["top","bottom"];return`absolute-${w===!0?n[0]:n[1]}${e?` text-${e}`:""}`}const Jt=["left","center","right","justify"],Xt=fe({name:"QTabs",props:{modelValue:[Number,String],align:{type:String,default:"center",validator:e=>Jt.includes(e)},breakpoint:{type:[String,Number],default:600},vertical:Boolean,shrink:Boolean,stretch:Boolean,activeClass:String,activeColor:String,activeBgColor:String,indicatorColor:String,leftIcon:String,rightIcon:String,outsideArrows:Boolean,mobileArrows:Boolean,switchIndicator:Boolean,narrowIndicator:Boolean,inlineLabel:Boolean,noCaps:Boolean,dense:Boolean,contentClass:String,"onUpdate:modelValue":[Function,Array]},setup(e,{slots:w,emit:k}){const{proxy:n}=Ve(),{$q:i}=n,{registerTick:S}=we(),{registerTick:_}=we(),{registerTick:h}=we(),{registerTimeout:p,removeTimeout:A}=Qe(),{registerTimeout:u,removeTimeout:X}=Qe(),L=q(null),R=q(null),D=q(e.modelValue),M=q(!1),E=q(!0),N=q(!1),j=q(!1),b=[],v=q(0),o=q(!1);let d=null,t=null,r;const m=V(()=>({activeClass:e.activeClass,activeColor:e.activeColor,activeBgColor:e.activeBgColor,indicatorClass:Yt(e.indicatorColor,e.switchIndicator,e.vertical),narrowIndicator:e.narrowIndicator,inlineLabel:e.inlineLabel,noCaps:e.noCaps})),ae=V(()=>{const a=v.value,c=D.value;for(let g=0;g<a;g++)if(b[g].name.value===c)return!0;return!1}),He=V(()=>`q-tabs__content--align-${M.value===!0?"left":j.value===!0?"justify":e.align}`),Ye=V(()=>`q-tabs row no-wrap items-center q-tabs--${M.value===!0?"":"not-"}scrollable q-tabs--${e.vertical===!0?"vertical":"horizontal"} q-tabs__arrows--${e.outsideArrows===!0?"outside":"inside"} q-tabs--mobile-with${e.mobileArrows===!0?"":"out"}-arrows`+(e.dense===!0?" q-tabs--dense":"")+(e.shrink===!0?" col-shrink":"")+(e.stretch===!0?" self-stretch":"")),Je=V(()=>"q-tabs__content scroll--mobile row no-wrap items-center self-stretch hide-scrollbar relative-position "+He.value+(e.contentClass!==void 0?` ${e.contentClass}`:"")),ie=V(()=>e.vertical===!0?{container:"height",content:"offsetHeight",scroll:"scrollHeight"}:{container:"width",content:"offsetWidth",scroll:"scrollWidth"}),re=V(()=>e.vertical!==!0&&i.lang.rtl===!0),ge=V(()=>St===!1&&re.value===!0);de(re,Z),de(()=>e.modelValue,a=>{pe({name:a,setCurrent:!0,skipEmit:!0})}),de(()=>e.outsideArrows,ue);function pe({name:a,setCurrent:c,skipEmit:g}){D.value!==a&&(g!==!0&&e["onUpdate:modelValue"]!==void 0&&k("update:modelValue",a),(c===!0||e["onUpdate:modelValue"]===void 0)&&(Xe(D.value,a),D.value=a))}function ue(){S(()=>{L.value&&Te({width:L.value.offsetWidth,height:L.value.offsetHeight})})}function Te(a){if(ie.value===void 0||R.value===null)return;const c=a[ie.value.container],g=Math.min(R.value[ie.value.scroll],Array.prototype.reduce.call(R.value.children,($,x)=>$+(x[ie.value.content]||0),0)),T=c>0&&g>c;M.value=T,T===!0&&_(Z),j.value=c<parseInt(e.breakpoint,10)}function Xe(a,c){const g=a!=null&&a!==""?b.find($=>$.name.value===a):null,T=c!=null&&c!==""?b.find($=>$.name.value===c):null;if(ce===!0)ce=!1;else if(g&&T){const $=g.tabIndicatorRef.value,x=T.tabIndicatorRef.value;d!==null&&(clearTimeout(d),d=null),$.style.transition="none",$.style.transform="none",x.style.transition="none",x.style.transform="none";const y=$.getBoundingClientRect(),U=x.getBoundingClientRect();x.style.transform=e.vertical===!0?`translate3d(0,${y.top-U.top}px,0) scale3d(1,${U.height?y.height/U.height:1},1)`:`translate3d(${y.left-U.left}px,0,0) scale3d(${U.width?y.width/U.width:1},1,1)`,h(()=>{d=setTimeout(()=>{d=null,x.style.transition="transform .25s cubic-bezier(.4, 0, .2, 1)",x.style.transform="none"},70)})}T&&M.value===!0&&G(T.rootRef.value)}function G(a){const{left:c,width:g,top:T,height:$}=R.value.getBoundingClientRect(),x=a.getBoundingClientRect();let y=e.vertical===!0?x.top-T:x.left-c;if(y<0){R.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.floor(y),Z();return}y+=e.vertical===!0?x.height-$:x.width-g,y>0&&(R.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.ceil(y),Z())}function Z(){const a=R.value;if(a===null)return;const c=a.getBoundingClientRect(),g=e.vertical===!0?a.scrollTop:Math.abs(a.scrollLeft);re.value===!0?(E.value=Math.ceil(g+c.width)<a.scrollWidth-1,N.value=g>0):(E.value=g>0,N.value=e.vertical===!0?Math.ceil(g+c.height)<a.scrollHeight:Math.ceil(g+c.width)<a.scrollWidth)}function $e(a){t!==null&&clearInterval(t),t=setInterval(()=>{et(a)===!0&&K()},5)}function Se(){$e(ge.value===!0?Number.MAX_SAFE_INTEGER:0)}function Pe(){$e(ge.value===!0?0:Number.MAX_SAFE_INTEGER)}function K(){t!==null&&(clearInterval(t),t=null)}function Ge(a,c){const g=Array.prototype.filter.call(R.value.children,U=>U===c||U.matches&&U.matches(".q-tab.q-focusable")===!0),T=g.length;if(T===0)return;if(a===36)return G(g[0]),g[0].focus(),!0;if(a===35)return G(g[T-1]),g[T-1].focus(),!0;const $=a===(e.vertical===!0?38:37),x=a===(e.vertical===!0?40:39),y=$===!0?-1:x===!0?1:void 0;if(y!==void 0){const U=re.value===!0?-1:1,O=g.indexOf(c)+y*U;return O>=0&&O<T&&(G(g[O]),g[O].focus({preventScroll:!0})),!0}}const Ze=V(()=>ge.value===!0?{get:a=>Math.abs(a.scrollLeft),set:(a,c)=>{a.scrollLeft=-c}}:e.vertical===!0?{get:a=>a.scrollTop,set:(a,c)=>{a.scrollTop=c}}:{get:a=>a.scrollLeft,set:(a,c)=>{a.scrollLeft=c}});function et(a){const c=R.value,{get:g,set:T}=Ze.value;let $=!1,x=g(c);const y=a<x?-1:1;return x+=y*5,x<0?($=!0,x=0):(y===-1&&x<=a||y===1&&x>=a)&&($=!0,x=a),T(c,x),Z(),$}function Re(a,c){for(const g in a)if(a[g]!==c[g])return!1;return!0}function tt(){let a=null,c={matchedLen:0,queryDiff:9999,hrefLen:0};const g=b.filter(y=>y.routeData?.hasRouterLink.value===!0),{hash:T,query:$}=n.$route,x=Object.keys($).length;for(const y of g){const U=y.routeData.exact.value===!0;if(y.routeData[U===!0?"linkIsExactActive":"linkIsActive"].value!==!0)continue;const{hash:O,query:be,matched:nt,href:it}=y.routeData.resolvedLink.value,he=Object.keys(be).length;if(U===!0){if(O!==T||he!==x||Re($,be)===!1)continue;a=y.name.value;break}if(O!==""&&O!==T||he!==0&&Re(be,$)===!1)continue;const W={matchedLen:nt.length,queryDiff:x-he,hrefLen:it.length-O.length};if(W.matchedLen>c.matchedLen){a=y.name.value,c=W;continue}else if(W.matchedLen!==c.matchedLen)continue;if(W.queryDiff<c.queryDiff)a=y.name.value,c=W;else if(W.queryDiff!==c.queryDiff)continue;W.hrefLen>c.hrefLen&&(a=y.name.value,c=W)}if(a===null&&b.some(y=>y.routeData===void 0&&y.name.value===D.value)===!0){ce=!1;return}pe({name:a,setCurrent:!0})}function lt(a){if(A(),o.value!==!0&&L.value!==null&&a.target&&typeof a.target.closest=="function"){const c=a.target.closest(".q-tab");c&&L.value.contains(c)===!0&&(o.value=!0,M.value===!0&&G(c))}}function at(){p(()=>{o.value=!1},30)}function oe(){Le.avoidRouteWatcher===!1?u(tt):X()}function Ie(){if(r===void 0){const a=de(()=>n.$route.fullPath,oe);r=()=>{a(),r=void 0}}}function ot(a){b.push(a),v.value++,ue(),a.routeData===void 0||n.$route===void 0?u(()=>{if(M.value===!0){const c=D.value,g=c!=null&&c!==""?b.find(T=>T.name.value===c):null;g&&G(g.rootRef.value)}}):(Ie(),a.routeData.hasRouterLink.value===!0&&oe())}function st(a){b.splice(b.indexOf(a),1),v.value--,ue(),r!==void 0&&a.routeData!==void 0&&(b.every(c=>c.routeData===void 0)===!0&&r(),oe())}const Le={currentModel:D,tabProps:m,hasFocus:o,hasActiveTab:ae,registerTab:ot,unregisterTab:st,verifyRouteModel:oe,updateModel:pe,onKbdNavigate:Ge,avoidRouteWatcher:!1};bt(ze,Le);function Ue(){d!==null&&clearTimeout(d),K(),r?.()}let De,ce;return Fe(Ue),gt(()=>{De=r!==void 0,Ue()}),pt(()=>{De===!0&&(Ie(),ce=!0,oe()),ue()}),()=>Q("div",{ref:L,class:Ye.value,role:"tablist",onFocusin:lt,onFocusout:at},[Q($t,{onResize:Te}),Q("div",{ref:R,class:Je.value,onScroll:Z},je(w.default)),Q(F,{class:"q-tabs__arrow q-tabs__arrow--left absolute q-tab__icon"+(E.value===!0?"":" q-tabs__arrow--faded"),name:e.leftIcon||i.iconSet.tabs[e.vertical===!0?"up":"left"],onMousedownPassive:Se,onTouchstartPassive:Se,onMouseupPassive:K,onMouseleavePassive:K,onTouchendPassive:K}),Q(F,{class:"q-tabs__arrow q-tabs__arrow--right absolute q-tab__icon"+(N.value===!0?"":" q-tabs__arrow--faded"),name:e.rightIcon||i.iconSet.tabs[e.vertical===!0?"down":"right"],onMousedownPassive:Pe,onTouchstartPassive:Pe,onMouseupPassive:K,onMouseleavePassive:K,onTouchendPassive:K})])}}),ve=fe({name:"QTabPanel",props:Pt,setup(e,{slots:w}){return()=>Q("div",{class:"q-tab-panel",role:"tabpanel"},je(w.default))}}),Gt=fe({name:"QTabPanels",props:{...It,...ht},emits:Rt,setup(e,{slots:w}){const k=Ve(),n=yt(e,k.proxy.$q),{updatePanelsList:i,getPanelContent:S,panelDirectives:_}=Lt(),h=V(()=>"q-tab-panels q-panel-parent"+(n.value===!0?" q-tab-panels--dark q-dark":""));return()=>(i(w),wt("div",{class:h.value},S(),"pan",e.swipeable,()=>_.value))}}),Zt={class:"text-h6"},el={class:"row items-center q-mt-md"},tl={class:"q-py-md"},ll={class:"col"},al={class:"col"},ol={key:0,class:"col-auto"},sl={class:"col-auto"},nl={class:"q-py-md"},il={class:"col"},rl={class:"col"},ul={class:"col"},cl={class:"col"},dl={class:"col"},ml={class:"q-py-md"},vl={class:"row items-center q-mb-sm"},fl={class:"col-auto text-subtitle1"},gl={__name:"RecipeDialog",emits:["saved"],setup(e,{expose:w,emit:k}){const n=k,i=Ke(),S=xt(),_=_t("mainImageAgent"),h=q({open:!1,id:""}),p=q(!1),A=()=>({name:"",description:"",ingredients:[{name:"",quantity:""}],steps:[{description:"",files:[],rawFiles:[]}],category:"",unlockPrice:0,status:"發佈",image:[],rawImage:[],existingImage:null,rating:0,nutrition:[{calories:0,protein:0,fat:0,carbs:0,netCarbs:0}]}),u=q(A()),X=["中式","日式","西式","甜點","其他"],L=V(()=>{const v=["草稿","發佈"];return S.isAdmin&&v.push("隱藏"),v}),R=()=>{u.value.ingredients.push({name:"",quantity:""})},D=v=>{u.value.ingredients.splice(v,1)},M=()=>{u.value.steps.push({description:"",files:[],rawFiles:[]})},E=v=>{u.value.steps.splice(v,1)},N=v=>{if(!S.isLoggedIn){i.notify({color:"warning",message:"請先登入",icon:"warning",position:"bottom"});return}if(h.value.open=!0,v){h.value.id=v._id;const o=JSON.parse(JSON.stringify(v));u.value={...o,image:[],existingImage:v.imageUrl,nutrition:v.nutrition&&v.nutrition.length>0?v.nutrition:[{calories:0,protein:0,fat:0,carbs:0,netCarbs:0}],steps:v.steps.map(d=>({description:d.description,image:d.imageUrl,files:[],rawFiles:[]}))}}else h.value.id="",u.value=A();_.value&&_.value.deleteFileRecord()},j=()=>{h.value.open=!1},b=async()=>{if(u.value.image.some(r=>r.error)){i.notify({message:"主圖片格式不符或檔案過大",color:"negative"});return}if(!h.value.id&&u.value.image.length===0){i.notify({message:"請上傳主圖片",color:"negative"});return}for(let r=0;r<u.value.steps.length;r++){const m=u.value.steps[r];if(!m.description.trim()){i.notify({message:`步驟 ${r+1} 請輸入說明`,color:"negative"});return}if(m.files.some(ae=>ae.error)){i.notify({message:`步驟 ${r+1} 的圖片格式不符或檔案過大`,color:"negative"});return}}const v=new FormData;["name","description","ingredients","nutrition","category","unlockPrice","rating","status"].forEach(r=>{r==="ingredients"||r==="nutrition"?v.append(r,JSON.stringify(u.value[r])):v.append(r,u.value[r])});let d=0;const t=u.value.steps.map(r=>{const ae=r.files.length>0&&r.files[0].file?d++:-1;return{description:r.description,image:r.image||null,fileIndex:ae}});v.append("steps",JSON.stringify(t)),u.value.image.length>0&&v.append("image",u.value.image[0].file),u.value.steps.forEach(r=>{r.files.length>0&&r.files[0].file&&v.append("stepImages",r.files[0].file)});try{if(p.value=!0,h.value.id)await qe.updateRecipe(h.value.id,v),i.notify({message:"更新成功",color:"positive"});else{const{data:r}=await qe.createRecipe(v);r.recipe&&S.pointLog.push(r.recipe),i.notify({message:"新增成功",color:"positive"})}j(),n("saved")}catch(r){console.log(r);const m=r?.response?.data?.message||"發生錯誤";i.notify({message:m,color:"negative"})}finally{p.value=!1}};return w({open:N}),(v,o)=>{const d=Ct("VueFileAgent");return C(),Y(Oe,{modelValue:h.value.open,"onUpdate:modelValue":o[8]||(o[8]=t=>h.value.open=t),persistent:""},{default:f(()=>[l(J,{style:{"min-width":"80vw","max-width":"80vw"}},{default:f(()=>[l(Bt,{onSubmit:Ee(b,["prevent"])},{default:f(()=>[l(H,null,{default:f(()=>[s("div",Zt,I(h.value.id?"編輯食譜":"新增食譜"),1)]),_:1}),l(H,{class:"q-gutter-md"},{default:f(()=>[l(B,{modelValue:u.value.name,"onUpdate:modelValue":o[0]||(o[0]=t=>u.value.name=t),label:"食譜名稱",rules:[t=>!!t||"請輸入食譜名稱"]},null,8,["modelValue","rules"]),s("div",el,[o[9]||(o[9]=s("div",{class:"text-subtitle1 q-mr-md"},"難易度",-1)),l(Mt,{modelValue:u.value.rating,"onUpdate:modelValue":o[1]||(o[1]=t=>u.value.rating=t),max:"5",size:"2em",color:"orange",icon:"star_border","icon-selected":"star"},null,8,["modelValue"])]),o[13]||(o[13]=s("div",{class:"text-h6 q-mt-lg"},"封面",-1)),u.value.image.length===0&&u.value.existingImage?(C(),Y(Be,{key:0,src:u.value.existingImage,style:{width:"200px",height:"auto","margin-bottom":"10px","border-radius":"8px"}},null,8,["src"])):se("",!0),l(d,{ref_key:"mainImageAgent",ref:_,modelValue:u.value.image,"onUpdate:modelValue":o[2]||(o[2]=t=>u.value.image=t),"raw-model-value":u.value.rawImage,"onUpdate:rawModelValue":o[3]||(o[3]=t=>u.value.rawImage=t),accept:"image/png,image/jpeg,image/jpg",deletable:"","max-files":1,"max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"}},null,8,["modelValue","raw-model-value"]),l(At,{modelValue:u.value.description,"onUpdate:modelValue":o[4]||(o[4]=t=>u.value.description=t),"min-height":"10rem",placeholder:"食譜說明"},null,8,["modelValue"]),s("div",tl,[o[10]||(o[10]=s("div",{class:"text-h6 q-mb-sm"},"食材內容",-1)),(C(!0),P(te,null,le(u.value.ingredients,(t,r)=>(C(),P("div",{key:r,class:"row q-col-gutter-sm q-mb-md items-start"},[s("div",ll,[l(B,{modelValue:t.name,"onUpdate:modelValue":m=>t.name=m,rules:[m=>!!m||"請輸入食材名稱"],filled:"",label:"食材名稱",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),s("div",al,[l(B,{modelValue:t.quantity,"onUpdate:modelValue":m=>t.quantity=m,rules:[m=>!!m||"請輸入食材份量"],filled:"",label:"食材份量",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),u.value.ingredients.length>1?(C(),P("div",ol,[l(z,{icon:"delete",flat:"",round:"",color:"negative",class:"q-mt-xs",onClick:m=>D(r)},null,8,["onClick"])])):se("",!0)]))),128)),s("div",sl,[l(z,{label:"新增食材",icon:"add",color:"primary",outline:"",class:"full-width",onClick:R})])]),s("div",nl,[o[11]||(o[11]=s("div",{class:"text-h6 q-mb-sm"},"營養標示",-1)),(C(!0),P(te,null,le(u.value.nutrition,(t,r)=>(C(),P("div",{key:r,class:"row q-col-gutter-sm q-mb-md items-start"},[s("div",il,[l(B,{modelValue:t.calories,"onUpdate:modelValue":m=>t.calories=m,rules:[m=>!!m||"請輸入熱量"],filled:"",label:"熱量",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),s("div",rl,[l(B,{modelValue:t.protein,"onUpdate:modelValue":m=>t.protein=m,rules:[m=>!!m||"請輸入蛋白質"],filled:"",label:"蛋白質",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),s("div",ul,[l(B,{modelValue:t.fat,"onUpdate:modelValue":m=>t.fat=m,rules:[m=>!!m||"請輸入脂肪"],filled:"",label:"脂肪",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),s("div",cl,[l(B,{modelValue:t.carbs,"onUpdate:modelValue":m=>t.carbs=m,rules:[m=>!!m||"請輸入碳水化合物"],filled:"",label:"碳水化合物",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])]),s("div",dl,[l(B,{modelValue:t.netCarbs,"onUpdate:modelValue":m=>t.netCarbs=m,rules:[m=>!!m||"請輸入淨碳水"],filled:"",label:"淨碳水",dense:""},null,8,["modelValue","onUpdate:modelValue","rules"])])]))),128))]),s("div",ml,[o[12]||(o[12]=s("div",{class:"text-h6 q-mb-sm"},"步驟",-1)),(C(!0),P(te,null,le(u.value.steps,(t,r)=>(C(),P("div",{key:r},[t.files.length===0&&t.image?(C(),Y(Be,{key:0,src:t.image,style:{width:"100px","margin-bottom":"5px"}},null,8,["src"])):se("",!0),s("div",vl,[s("div",fl,"步驟 "+I(r+1),1),l(ke),u.value.steps.length>1?(C(),Y(z,{key:0,icon:"delete",flat:"",round:"",color:"negative",onClick:m=>E(r)},null,8,["onClick"])):se("",!0)]),l(B,{modelValue:t.description,"onUpdate:modelValue":m=>t.description=m,type:"textarea",label:"步驟說明",rules:[m=>!!m||"請輸入步驟說明"],filled:"",class:"q-mb-sm"},null,8,["modelValue","onUpdate:modelValue","rules"]),l(d,{modelValue:t.files,"onUpdate:modelValue":m=>t.files=m,"raw-model-value":t.rawFiles,"onUpdate:rawModelValue":m=>t.rawFiles=m,accept:"image/png,image/jpeg,image/jpg",deletable:"","max-files":50,multiple:"","max-size":"1MB","help-text":"選擇此步驟的圖片 (可選)","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"}},null,8,["modelValue","onUpdate:modelValue","raw-model-value","onUpdate:rawModelValue"])]))),128)),l(z,{label:"新增步驟",onClick:M,color:"primary",class:"q-mt-md"})]),l(Ae,{modelValue:u.value.category,"onUpdate:modelValue":o[5]||(o[5]=t=>u.value.category=t),options:X,label:"分類",rules:[t=>!!t||"請選擇分類"]},null,8,["modelValue","rules"]),l(B,{modelValue:u.value.unlockPrice,"onUpdate:modelValue":o[6]||(o[6]=t=>u.value.unlockPrice=t),modelModifiers:{number:!0},type:"number",label:"解鎖積分",rules:[t=>t>=0||"積分不能小於 0"]},null,8,["modelValue","rules"]),l(Ae,{modelValue:u.value.status,"onUpdate:modelValue":o[7]||(o[7]=t=>u.value.status=t),options:L.value,label:"狀態","emit-value":"","map-options":"",rules:[t=>t!==null||"請選擇狀態"]},null,8,["modelValue","options","rules"])]),_:1}),l(qt,{align:"right",class:"q-pa-md"},{default:f(()=>[l(z,{flat:"",label:"取消",color:"negative",onClick:j,disable:p.value},null,8,["disable"]),l(z,{type:"submit",label:"儲存",color:"primary",loading:p.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},pl={class:"text-weight-bold"},bl={class:"text-caption text-grey-7"},hl={__name:"PointLogTable",props:{logs:{type:Array,default:()=>[]}},setup(e){const w={獲得:{icon:"check_circle",bgColor:"green-1",textColor:"green"},消耗:{icon:"lock_open",bgColor:"orange-1",textColor:"deep-orange"},default:{icon:"info",bgColor:"grey-1",textColor:"grey"}},k=_=>w[_]||w.default,n=_=>{if(!_)return"";const h=new Date(_),p=new Date,A=ee.subtractFromDate(p,{days:1}),u=ee.formatDate(h,"hh:mm A");return ee.isSameDate(h,p,"day")?`Today, ${u}`:ee.isSameDate(h,A,"day")?`Yesterday, ${u}`:ee.formatDate(h,"MMM DD, YYYY, hh:mm A")},i=[{name:"type",label:"",align:"left",field:"type",style:"width: 50px"},{name:"info",label:"Details",align:"left",field:_=>`${_.title} ${_.description}`,sortable:!1},{name:"date",label:"Date",align:"right",field:"createdAt",sortable:!0,format:_=>n(_)},{name:"amount",label:"Points",align:"right",field:"amount",sortable:!0}],S=q({sortBy:"date",descending:!0,page:1,rowsPerPage:10});return(_,h)=>(C(),Y(zt,{flat:"",rows:e.logs,columns:i,"row-key":"_id",pagination:S.value,"onUpdate:pagination":h[0]||(h[0]=p=>S.value=p),"no-data-label":"No history available.",separator:"horizontal"},{"body-cell-type":f(p=>[l(me,{props:p,"auto-width":""},{default:f(()=>[l(ne,{color:k(p.row.type).bgColor,"text-color":k(p.row.type).textColor,icon:k(p.row.type).icon,size:"md"},null,8,["color","text-color","icon"])]),_:2},1032,["props"])]),"body-cell-info":f(p=>[l(me,{props:p},{default:f(()=>[s("div",pl,I(p.row.title),1),s("div",bl,I(p.row.description),1)]),_:2},1032,["props"])]),"body-cell-date":f(p=>[l(me,{props:p},{default:f(()=>[Ce(I(p.value),1)]),_:2},1032,["props"])]),"body-cell-amount":f(p=>[l(me,{props:p},{default:f(()=>[s("div",{class:_e(["text-h6 text-weight-bold",p.row.type==="獲得"?"text-green":"text-deep-orange"])},I(p.row.type==="獲得"?"+":"-")+I(p.row.amount),3)]),_:2},1032,["props"])]),"no-data":f(()=>[...h[1]||(h[1]=[s("div",{class:"full-width row flex-center q-pa-lg text-grey"},"No history available.",-1)])]),_:1},8,["rows","pagination"]))}},yl={class:"row items-center q-pa-md q-gutter-sm"},wl={key:0,class:"row q-col-gutter-md q-pa-md"},xl={key:1,class:"text-center q-pa-xl text-grey"},_l={class:"text-h6"},Cl={key:2,class:"text-center q-pa-xl text-grey"},xe={__name:"ProfileRecipeList",props:{recipes:{type:Array,default:()=>[]},search:{type:String,default:""},placeholder:{type:String,default:"搜尋"},emptyIcon:{type:String,default:"info"},emptyText:{type:String,default:"尚無資料"},emptyBtnLabel:{type:String,default:""},emptyBtnTo:{type:[String,Object],default:""}},emits:["update:search","click-recipe"],setup(e){return(w,k)=>(C(),P("div",null,[s("div",yl,[l(B,{dense:"",outlined:"","model-value":e.search,"onUpdate:modelValue":k[0]||(k[0]=n=>w.$emit("update:search",n)),placeholder:e.placeholder,class:"col","bg-color":"white"},{prepend:f(()=>[l(F,{name:"search"})]),_:1},8,["model-value","placeholder"]),Me(w.$slots,"actions")]),e.recipes&&e.recipes.length>0?(C(),P("div",wl,[(C(!0),P(te,null,le(e.recipes,n=>(C(),P("div",{class:"col-12 col-sm-6 col-md-3",key:n._id},[l(Ft,{recipe:n,onClick:i=>w.$emit("click-recipe",n._id)},{"image-overlay":f(()=>[Me(w.$slots,"image-overlay",{recipe:n})]),_:2},1032,["recipe","onClick"])]))),128))])):e.search?(C(),P("div",Cl,[...k[1]||(k[1]=[s("div",{class:"text-h6"},"找不到符合的食譜",-1)])])):(C(),P("div",xl,[l(F,{name:e.emptyIcon,size:"64px",class:"q-mb-md"},null,8,["name"]),s("div",_l,I(e.emptyText),1),e.emptyBtnLabel?(C(),Y(z,{key:0,to:e.emptyBtnTo,label:e.emptyBtnLabel,color:"deep-orange",flat:"",class:"q-mt-sm"},null,8,["to","label"])):se("",!0)]))]))}},ql={class:"row q-col-gutter-md q-mb-xl"},kl={class:"col-12 col-md-3"},Vl={class:"row justify-between items-start"},Tl={class:"text-h4 text-weight-bolder"},$l={class:"col-12 col-md-3"},Sl={class:"row justify-between items-start"},Pl={class:"text-h4 text-weight-bolder"},Rl={class:"col-12 col-md-3"},Il={class:"row justify-between items-start"},Ll={class:"text-h4 text-weight-bolder"},Ul={class:"col-12 col-md-3"},Dl={class:"row justify-between items-start"},Ql={class:"row items-center"},Ml={class:"row items-baseline"},Al={class:"text-h4 text-weight-bolder"},Bl={class:"q-gutter-y-sm"},zl={__name:"ProfileStatCards",props:{totalPoints:{type:Number,default:0},savedCount:{type:Number,default:0},unlockedCount:{type:Number,default:0},missionProgress:{type:Number,default:0},missions:{type:Array,default:()=>[]}},setup(e){const w=q(!1);return(k,n)=>(C(),P("div",ql,[s("div",kl,[l(J,{flat:"",class:"stat-card q-pa-sm"},{default:f(()=>[l(H,null,{default:f(()=>[s("div",Vl,[l(ne,{color:"orange-1","text-color":"orange-9",icon:"account_balance_wallet",size:"50px","font-size":"28px",rounded:""}),l(F,{name:"trending_up",color:"grey-4",size:"md"})]),n[3]||(n[3]=s("div",{class:"text-overline text-grey-7 q-mt-md"},"TOTAL POINTS",-1)),s("div",Tl,[Ce(I(e.totalPoints)+" ",1),n[2]||(n[2]=s("span",{class:"text-subtitle1 text-grey text-weight-normal"},"pts",-1))])]),_:1})]),_:1})]),s("div",$l,[l(J,{flat:"",class:"stat-card q-pa-sm"},{default:f(()=>[l(H,null,{default:f(()=>[s("div",Sl,[l(ne,{color:"green-1","text-color":"green-8",icon:"soup_kitchen",size:"50px","font-size":"28px",rounded:""}),l(F,{name:"check_circle",color:"green-2",size:"md"})]),n[4]||(n[4]=s("div",{class:"text-overline text-grey-7 q-mt-md"},"收藏食譜數",-1)),s("div",Pl,I(e.savedCount),1)]),_:1})]),_:1})]),s("div",Rl,[l(J,{flat:"",class:"stat-card q-pa-sm"},{default:f(()=>[l(H,null,{default:f(()=>[s("div",Il,[l(ne,{color:"blue-1","text-color":"blue-8",icon:"menu_book",size:"50px","font-size":"28px",rounded:""}),l(F,{name:"lock_open",color:"blue-2",size:"md"})]),n[5]||(n[5]=s("div",{class:"text-overline text-grey-7 q-mt-md"},"解鎖食譜數",-1)),s("div",Ll,I(e.unlockedCount),1)]),_:1})]),_:1})]),s("div",Ul,[l(J,{flat:"",class:"stat-card q-pa-sm"},{default:f(()=>[l(H,null,{default:f(()=>[s("div",Dl,[l(ne,{color:"purple-1","text-color":"purple-8",icon:"assignment_turned_in",size:"50px","font-size":"28px",rounded:""}),s("div",Ql,[l(z,{flat:"",round:"",color:"purple-8",icon:"list_alt",size:"sm",onClick:n[0]||(n[0]=i=>w.value=!0)},{default:f(()=>[l(Nt,null,{default:f(()=>[...n[6]||(n[6]=[Ce("查看每日任務",-1)])]),_:1})]),_:1}),l(F,{name:"emoji_events",color:"purple-2",size:"md"})])]),n[8]||(n[8]=s("div",{class:"text-overline text-grey-7 q-mt-md"},"任務完成率",-1)),s("div",Ml,[s("div",Al,I(Math.round(e.missionProgress*100)),1),n[7]||(n[7]=s("div",{class:"text-subtitle1 text-grey text-weight-normal q-ml-xs"},"%",-1))])]),_:1})]),_:1})]),l(Oe,{modelValue:w.value,"onUpdate:modelValue":n[1]||(n[1]=i=>w.value=i)},{default:f(()=>[l(J,{style:{"min-width":"300px","border-radius":"12px"}},{default:f(()=>[l(H,{class:"row items-center q-pb-none"},{default:f(()=>[n[9]||(n[9]=s("div",{class:"text-h6 text-weight-bold"},"每日任務牆",-1)),l(ke),Ne(l(z,{icon:"close",flat:"",round:"",dense:""},null,512),[[jt]])]),_:1}),l(H,null,{default:f(()=>[s("div",Bl,[(C(!0),P(te,null,le(e.missions,i=>(C(),P("div",{key:i.name,class:"row items-center"},[l(F,{name:i.isCompleted?"check_circle":"radio_button_unchecked",color:i.isCompleted?"green":"grey-4",size:"xs",class:"q-mr-sm"},null,8,["name","color"]),s("span",{class:_e(["text-body2",i.isCompleted?"text-grey-5":"text-grey-8"])},I(i.name),3),l(ke),s("span",{class:_e(["text-caption",i.isCompleted?"text-grey-5":"text-grey-8"])},I(i.currentCount)+"/"+I(i.dailyLimit),3)]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Fl=We(zl,[["__scopeId","data-v-143ab1d0"]]),Nl={class:"col-12",style:{"max-width":"1200px"}},jl={class:"q-my-lg"},El={class:"text-h4 text-weight-bolder q-mb-xs"},Ol={class:"q-pa-md q-ma-auto",style:{"max-width":"1200px"}},Kl={class:"absolute-top-right q-pa-sm bg-transparent"},Wl={__name:"profilePage",setup(e){const w=Vt(),k=Ke(),n=q({}),i=q([]),S=q("logs"),_=q(""),h=q(""),p=q(""),A=q(null),u=q([]);(async()=>{try{const{data:o}=await Qt.getMission();u.value=o.result}catch(o){console.log(o)}})();const L=V(()=>{const o=n.value.missionStatus||{};return u.value.map(d=>{let t=!1,r=0;return d.code==="每日簽到"&&ee.isSameDate(new Date(o.lastLoginDate),new Date,"day")&&(t=!0,r=1),d.code==="發文"&&(r=o.dailyPostCount,r>=d.dailyLimit&&(t=!0)),d.code==="新增食譜"&&(r=o.dailyRecipeCount,r>=d.dailyLimit&&(t=!0)),{...d,isCompleted:t,currentCount:r}})}),R=V(()=>L.value.length===0?0:L.value.filter(o=>o.isCompleted).length/L.value.length),D=V(()=>[{title:"我的食譜",name:"myRecipes"},{title:"收藏食譜",name:"savedRecipes"},{title:"解鎖食譜",name:"unlockedRecipes"},{title:"積分紀錄",name:"logs"}]),M=V(()=>{if(!_.value)return i.value;const o=_.value.toLowerCase();return i.value.filter(d=>d.name.toLowerCase().includes(o))}),E=V(()=>{const o=n.value.savedRecipes||[];if(!h.value)return o;const d=h.value.toLowerCase();return o.filter(t=>t.name.toLowerCase().includes(d))}),N=V(()=>{const o=n.value.unlockedRecipes||[];if(!p.value)return o;const d=p.value.toLowerCase();return o.filter(t=>t.name.toLowerCase().includes(d))}),j=o=>{A.value.open(o)},b=async()=>{try{const{data:o}=await kt.getUser();n.value=o.result;try{const{data:d}=await qe.getMyRecipes();i.value=d.result}catch(d){console.log("取不到我的食譜",d)}}catch(o){console.log(o),k.notify({color:"negative",message:"無法取得使用者資訊",icon:"report_problem",position:"bottom"})}};b();const v=o=>{w.push(`/recipes/${o}`)};return(o,d)=>(C(),Y(Dt,null,{default:f(()=>[l(Ut,{class:"row justify-center q-pa-md"},{default:f(()=>[s("div",Nl,[s("div",jl,[s("h1",El,"歡迎回來 "+I(n.value.account),1)]),l(Fl,{"total-points":n.value.points?.totalEarned||0,"saved-count":n.value.savedRecipes?.length||0,"unlocked-count":n.value.unlockedRecipes?.length||0,"mission-progress":R.value,missions:L.value},null,8,["total-points","saved-count","unlocked-count","mission-progress","missions"]),s("div",Ol,[l(J,{flat:"",class:"main-content-card"},{default:f(()=>[l(Xt,{modelValue:S.value,"onUpdate:modelValue":d[0]||(d[0]=t=>S.value=t),class:"text-grey-8","active-color":"orange-9","indicator-color":"orange-9",align:"left","content-class":"q-px-md"},{default:f(()=>[(C(!0),P(te,null,le(D.value,t=>(C(),Y(Ht,{key:t.name,name:t.name,label:t.title,class:"text-weight-bold text-capitalize"},null,8,["name","label"]))),128))]),_:1},8,["modelValue"]),l(Tt,{color:"grey-2"}),l(Gt,{modelValue:S.value,"onUpdate:modelValue":d[5]||(d[5]=t=>S.value=t),animated:""},{default:f(()=>[l(ve,{name:"logs",class:"q-pa-none"},{default:f(()=>[l(hl,{logs:n.value.pointLog||[]},null,8,["logs"])]),_:1}),l(ve,{name:"savedRecipes",class:"q-pa-none"},{default:f(()=>[l(xe,{recipes:E.value,search:h.value,"onUpdate:search":d[1]||(d[1]=t=>h.value=t),placeholder:"搜尋收藏食譜","empty-icon":"bookmark_border","empty-text":"尚未收藏任何食譜","empty-btn-label":"去探索食譜","empty-btn-to":"/recipes",onClickRecipe:v},null,8,["recipes","search"])]),_:1}),l(ve,{name:"unlockedRecipes",class:"q-pa-none"},{default:f(()=>[l(xe,{recipes:N.value,search:p.value,"onUpdate:search":d[2]||(d[2]=t=>p.value=t),placeholder:"搜尋解鎖食譜","empty-icon":"lock_open","empty-text":"尚未解鎖任何食譜","empty-btn-label":"去探索食譜","empty-btn-to":"/recipes",onClickRecipe:v},null,8,["recipes","search"])]),_:1}),l(ve,{name:"myRecipes",class:"q-pa-none"},{default:f(()=>[l(xe,{recipes:M.value,search:_.value,"onUpdate:search":d[4]||(d[4]=t=>_.value=t),placeholder:"搜尋我的食譜","empty-icon":"menu_book","empty-text":"尚未新增任何食譜","empty-btn-label":"去探索食譜","empty-btn-to":"/recipes",onClickRecipe:v},{actions:f(()=>[l(z,{color:"deep-orange",icon:"add",label:"新增食譜",onClick:d[3]||(d[3]=t=>j(null)),unelevated:""})]),"image-overlay":f(({recipe:t})=>[s("div",Kl,[l(z,{icon:"edit",round:"",color:"white","text-color":"primary",size:"sm",class:"shadow-3",onClick:Ee(r=>j(t),["stop"])},null,8,["onClick"])])]),_:1},8,["recipes","search"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),l(gl,{ref_key:"recipeDialogRef",ref:A,onSaved:b},null,512)]),_:1})]),_:1}))}},Ca=We(Wl,[["__scopeId","data-v-0752d854"]]);export{Ca as default};
